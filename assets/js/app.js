var app;!function(){"use strict";var e;app=function(){var e,t,n,o,r,i;return e={},e.shared={},i=e.shared,t={body:document.querySelectorAll(".body.control")[0],fileInput:document.getElementById("file")},n=function(){var n,o,r,i,a,d,l,c,s,u,f,m,p,g,v,w,y;n=t.fileInput,a=document.getElementById("editorView"),d=document.getElementById("renderedView"),y={prefix:"",content:"",suffix:""},localStorage.getItem("fileVersion")?c=parseInt(localStorage.getItem("fileVersion"),10):(c=0,localStorage.setItem("fileVersion",c)),s=function(e){e.innerHTML=e.innerHTML.replace(/contenteditable=\"true\"/gim,""),e.innerHTML=e.innerHTML.replace(/contenteditable=\'true\'/gim,"")},m=function(e){if(null!==e.match(/td.*(style).*>/gim)&&null!==e.match(/td.*(width).*>/gim)){if(null!==e.match(/td.*(style).*width.*>/gim))return e.replace(/td(.*)style.*=.*"(.*)"(.*)width.*=.*".*(\d).*"(.*)>(.*)<\/td/gim,'td $1 style="$2 width: $4px;" $3 width="$4" $5>$6</');if(null!==e.match(/td.*width.*(style).*>/gim))return e.replace(/td(.*)width.*=.*".*(\d).*"(.*)style.*=.*"(.*)"(.*)>(.*)<\/td/gim,'td $1 width="$2" $3 style="$4 width: $2px;" $5>$6</')}else if(null!==e.match(/td.*(width).*>/gim))return e.replace(/td(.*)width.*="(\d)"(.*)>(.*)<\/td/gim,"td $1 width = '$2' $3 style=\"width: $2px;\">$4</")},u=function(e){return e.replace(/>(\n+|[\n+&nbsp;+\n+])<\//gim,">&nbsp;</")},f=function(e){return e.replace(/td(.*)><\/td/gim,"td $1 >&nbsp;</")},p=function(e){return f(e).replace(/href/gim,"disabled-href")},g=function(e){return e.replace(/disabled-href/gim,"href")},w=function(e){return y.prefix+e+y.suffix},l=function(e){var t,n,o;t="editorView"===e.id?"innerText":"innerHTML",n="editorView"===e.id?"innerHTML":"innerText",o="editorView"===e.id?d:a,e[t]="editorView"===e.id?w(g(o[n])):p(o[n])},e.shared.watchKeyUp=l,a.addEventListener("keyup",function(){l(d)}),a.addEventListener("keydown",function(e){9===e.keyCode&&e.shiftKey?(e.preventDefault(),document.execCommand("styleWithCSS",!0,null),document.execCommand("outdent",!0,null)):9===e.keyCode&&(e.preventDefault(),document.execCommand("styleWithCSS",!0,null),document.execCommand("indent",!0,null))}),d.addEventListener("keyup",function(){l(a)}),d.addEventListener("mousedown",function(e){var t,n,o;t=function(e){return""!==e.textContent.replace(/\s+/gim,"")},n=function(){var t,n;return n=function(){var t;return t=["font","span","p","b","i","a","strong","em"],-1!==t.indexOf(e.target.nodeName.toLowerCase())},n()?t=e.target:3===e.target.nodeType&&(t=e.target.parentNode),t},o=n(),o&&t(o)&&(o.contentEditable=!0,o.addEventListener("blur",function(){o.outerHTML=o.outerHTML.replace(/contenteditable=(\"|\')true(\"|\')/,"")}))}),a.addEventListener("mousedown",function(){s(d)}),n.addEventListener("change",function(){var e;e=document.getElementById("views"),r=this.files[0],o=new FileReader,o.onload=function(){var n,o,u;i=this.result,n=i.substring(0,i.indexOf("table")-1),y.prefix=n,o=i.substring(i.lastIndexOf("</table>")+"</table>".length,i.length),y.suffix=o,u=i.substring(i.indexOf("table")-1,i.lastIndexOf("</table>")+"</table>".length),y.content=u,a.innerText=i,d.innerHTML=p(u),setTimeout(function(){e.className=e.className+" flipped"},600),setTimeout(function(){a.style.display="none"},900),v||(v=document.createElement("div"),v.id="save",v.className="save btn ui",v.innerHTML="Salvar arquivo",t.body.appendChild(v),document.getElementById("save").addEventListener("mousedown",function(){s(d),l(a);var e=new Blob([a.innerText],{type:"text/plain;charset=utf-8"});localStorage.getItem("fileName")?localStorage.getItem("fileName")===r.name?c+=1:(localStorage.setItem("fileName",r.name),c=0):localStorage.setItem("fileName",r.name),localStorage.setItem("fileVersion",c),saveAs(e,r.name.replace(".html","_"+c+".html"))}))},o.onerror=function(e){throw e},o.readAsText(r)})},o=function(){var e,n,o;t.fileInput.style.opacity="0.0001",t.fileInput.style.position="absolute",t.fileInput.style.zIndex="1",e=document.createElement("div"),e.className="ui btn open",e.innerHTML="Abrir arquivo",t.fileInput.parentNode.appendChild(e),o=document.getElementById("views"),n=document.querySelectorAll(".top.container")[0],o.style.cssText=o.style.cssText+"height: "+parseInt(window.innerHeight-n.offsetHeight,10)+"px;"},r=function(){var e;return e={},e.richEditor=function(){var e,t,n,o,r,i,a,d,l,c,s,u,f,m;e=document.getElementById("baloon"),s={strong:document.getElementById("btn_strong"),emphasis:document.getElementById("btn_emphasis")},t=e.style.cssText,n=e.className,o=52,r=document.getElementById("renderedView"),a=function(n){e.style.cssText=t+n},i=function(t){var o=t||"";e.className=n+" "+o},d=function(e){var t;do t=e.parentNode;while(1!==t.nodeType);return t},u=function(e,t,n){var o,r,i,a,d;o=t&&e,r=n.target,i=-1!==r.className.indexOf("strong")?"strong":"emphasis",o&&("strong"===i?"strong"===t.nodeName.toLowerCase()||(a=document.createElement("strong"),e.surroundContents(a)):"em"===t.nodeName.toLowerCase()||(d=document.createElement("em"),e.surroundContents(d)))},e.addEventListener("mouseup",function(e){u(f,m,e)}),r.addEventListener("mousedown",function(e){l=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}),r.addEventListener("mouseup",function(e){var t,n,r,s,u,p,g,v,w;c=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t=window.getSelection(),v=function(e){var t;f=e.getRangeAt(0),m=d(f.commonAncestorContainer),t=parseInt(window.getComputedStyle(m,null).getPropertyValue("line-height"),10),n=f.getBoundingClientRect(),r="margin-top: "+parseInt(n.top,10)+"px; ",u=c>l?l:c,p="left: "+parseInt(u,10)+"px; ",s="top: -"+parseInt(12+o+t,10)+"px;",g=r+p+s,a(g),i("active")},w=t&&3===t.anchorNode.nodeType&&t.getRangeAt(0).endOffset!==t.getRangeAt(0).startOffset,w?v(t):i(),window.addEventListener("scroll",function(){w?v(t):i()})})},e.imageEditor=function(){var e,t,n,o,r,a,d,l,c,s;e=document.getElementById("renderedView"),t=document.getElementById("editorView"),n=document.getElementById("imagebox"),r=n.className,o=function(e,t,n){n[e]=t.value},l=function(e){("src"===e.target.id||"alt"===e.target.id)&&(o(e.target.id,s[e.target.id],c),i.watchKeyUp(t))},a=function(){n.className=r,n.removeEventListener("keyup",l,!1)},d=function(){a()},e.addEventListener("mousedown",function(e){var u,f,m,p;"img"===e.target.nodeName.toLowerCase()&&(u=document.getElementById("alt"),f=document.getElementById("src"),s={alt:u,src:f},c=e.target,p=function(){d(),n.className=r+" active",m={alt:c.alt,src:c.src},n.addEventListener("keyup",l,!1)},u.value=c.alt,f.value=c.src,p(),n.addEventListener("mousedown",function(e){var n;n=function(e){var n,r;n=-1!==e.indexOf("cancel")?"cancel":"done",r={cancel:function(){u.value=m.alt,f.value=m.src,o("alt",s.alt,c),o("src",s.src,c),i.watchKeyUp(t),a()},done:function(){a()}},r[n]()},("btn cancel"===e.target.className||"btn done"===e.target.className)&&n(e.target.className)}))})},e},e.init=function(){n(),o(),r().imageEditor()},e.error=function(){throw new Error("The File APIs are not fully supported by your browser.")},e},e=window.File&&window.FileReader&&window.FileList&&window.Blob,app()[e?"init":"error"]()}();var saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,i=function(n){var o=t.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(o)},a=e.webkitRequestFileSystem,d=e.requestFileSystem||a||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",s=0,u=500,f=function(t){var o=function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()};e.chrome?o():setTimeout(o,u)},m=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(i){l(i)}}},p=function(t,l){var u,p,g,v=this,w=t.type,y=!1,h=function(){m(v,"writestart progress write writeend".split(" "))},E=function(){if((y||!u)&&(u=n().createObjectURL(t)),p)p.location.href=u;else{var o=e.open(u,"_blank");void 0==o&&"undefined"!=typeof safari&&(e.location.href=u)}v.readyState=v.DONE,h(),f(u)},b=function(e){return function(){return v.readyState!==v.DONE?e.apply(this,arguments):void 0}},I={create:!0,exclusive:!1};return v.readyState=v.INIT,l||(l="download"),r?(u=n().createObjectURL(t),o.href=u,o.download=l,i(o),v.readyState=v.DONE,h(),void f(u)):(e.chrome&&w&&w!==c&&(g=t.slice||t.webkitSlice,t=g.call(t,0,t.size,c),y=!0),a&&"download"!==l&&(l+=".download"),(w===c||a)&&(p=e),d?(s+=t.size,void d(e.TEMPORARY,s,b(function(e){e.root.getDirectory("saved",I,b(function(e){var n=function(){e.getFile(l,I,b(function(e){e.createWriter(b(function(n){n.onwriteend=function(t){p.location.href=e.toURL(),v.readyState=v.DONE,m(v,"writeend",t),f(e)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&E()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=v["on"+e]}),n.write(t),v.abort=function(){n.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),E)}),E)};e.getFile(l,{create:!1},b(function(e){e.remove(),n()}),b(function(e){e.code===e.NOT_FOUND_ERR?n():E()}))}),E)}),E)):void E())},g=p.prototype,v=function(e,t){return new p(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,m(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,v}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs});